
<img src="https://capsule-render.vercel.app/api?type=waving&color=999999&height=300&section=header&text=DB-Backup-Automization&fontSize=50&fontColor=FFFFFF&animation=fadeIn&width=1200" width="1200" />


<br>

|<img src="https://github.com/DoomchitYJ.png" width="220" />|<img src="https://github.com/imhaeunim.png" width="220" />|<img src="https://github.com/jinhyunpark929.png" width="220" />|<img src="https://github.com/letmeloveyou82.png" width="220" />|
|:-:|:-:|:-:|:-:|
|ë°•ì˜ì§„<br/>[@DoomchitYJ](https://github.com/DoomchitYJ)|ì„í•˜ì€<br/>[@imhaeunim](https://github.com/imhaeunim)|ë°•ì§„í˜„<br/>[@jinhyunpark929](https://github.com/jinhyunpark929)|ìµœìœ¤ì •<br/>[@letmeloveyou82](https://github.com/letmeloveyou82)|

<br>

## ğŸ“ Contents
- [1ï¸âƒ£ Goals](#1%EF%B8%8Fâƒ£-goals)
- [2ï¸âƒ£ Architecture](#2%EF%B8%8Fâƒ£-architecture)
- [3ï¸âƒ£ Skills](#3%EF%B8%8Fâƒ£-skills)
- [4ï¸âƒ£ Expectations](#4%EF%B8%8Fâƒ£-expectations)
- [5ï¸âƒ£ How to do](#5%EF%B8%8Fâƒ£-how-to-do)
- [6ï¸âƒ£ Trouble Shooting](#6%EF%B8%8F%E2%83%A3-trouble-shooting)
- [7ï¸âƒ£ Retrospective](#7%EF%B8%8F%E2%83%A3-retrospective)

<br>

## 1ï¸âƒ£ Goals

### ğŸš€ 1. ì»¨í…Œì´ë„ˆ ê¸°ë°˜ì˜ ë°ì´í„°ë² ì´ìŠ¤ ë°°í¬ ë° ê´€ë¦¬ ìµœì í™”

- **Docker Compose**ë¥¼ í™œìš©í•˜ì—¬ Spring Boot & MySQL í™˜ê²½ì„ ì‰½ê²Œ ë°°í¬

- MySQL ë°ì´í„°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ì—¬ **ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ì‹œì—ë„ ë°ì´í„° ìœ ì§€**

### ğŸ’¾ 2. MySQL ë°ì´í„° ë°±ì—… ìë™í™”

- cron + bash scriptë¥¼ í™œìš©í•œ **ìë™ ë°±ì—…**ìœ¼ë¡œ ë°ì´í„° ìœ ì‹¤ ë°©ì§€

- mysqldumpë¥¼ ì‚¬ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤ëƒ…ìƒ· ì €ì¥ ë° **ë¬´ê²°ì„±** ìœ ì§€

- 7ì¼ ì´ìƒ ëœ ë°±ì—… ìë™ ì‚­ì œë¥¼ í†µí•´ **ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬ ìµœì í™”**

### ğŸŒ 3. í™•ì¥ì„±ê³¼ ìš´ì˜ í™˜ê²½ ê³ ë ¤

- ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤ ë°°í¬ ê°€ëŠ¥ (Spring Boot ì»¨í…Œì´ë„ˆ ì—¬ëŸ¬ ê°œ ì‚¬ìš©)

- MySQL ì»¨í…Œì´ë„ˆ **healthcheck** ì„¤ì •ìœ¼ë¡œ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ë³´ì¥

- Docker **Volumeê³¼ ë„¤íŠ¸ì›Œí¬ ì„¤ì •**ìœ¼ë¡œ ë°ì´í„° ì¼ê´€ì„± ë° ë³´ì•ˆ ìœ ì§€

<br>

## 2ï¸âƒ£ Architecture
<br>

![docker-compose](https://github.com/user-attachments/assets/93a9b7dd-957b-4e4a-85f3-75de29aaded5)


## 3ï¸âƒ£ Skills

### **Tech Stack**

<div>
  <img src="https://img.shields.io/badge/docker-2496ED?style=for-the-badge&logo=docker&logoColor=white">
  <img src="https://img.shields.io/badge/docker--compose-1488C6?style=for-the-badge&logo=docker&logoColor=white">
  <img src="https://img.shields.io/badge/cron-333333?style=for-the-badge&logo=linux&logoColor=white">
  <img src="https://img.shields.io/badge/ubuntu-E95420?style=for-the-badge&logo=ubuntu&logoColor=white">
  <img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
  <img src="https://img.shields.io/badge/springboot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white">
</div>

<br>

### **Co-work Stack**

<div>
<img src="https://img.shields.io/badge/notion-000000?style=for-the-badge&logo=notion&logoColor=white">
<img src="https://img.shields.io/badge/github-303a50?style=for-the-badge&logo=github&logoColor=white">
<img src="https://img.shields.io/badge/slack-e01e5a?style=for-the-badge&logo=slack&logoColor=white">
</div>

<br>


## ğŸ“ **Project File Structure (`ex.. 07.dockerComposeMission`)**

```
07.dockerComposeMission/
â”œâ”€â”€ db-backup/                   # ğŸ“‚ MySQL ë°±ì—… íŒŒì¼ ì €ì¥ í´ë”
â”‚   â”œâ”€â”€ fisa_backup_20250321_000001.sql  # ğŸ“„ MySQL ë°±ì—… íŒŒì¼ (Timestamp í¬í•¨)
â”‚   â”œâ”€â”€ fisa_backup_20250322_000001.sql
â”‚   â”œâ”€â”€ fisa_backup_20250323_000001.sql
|
â”œâ”€â”€ backup.sh                     # ğŸ“œ MySQL ìë™ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ docker-compose.yml             # âš™ï¸ Docker Compose ì„¤ì • íŒŒì¼
â”œâ”€â”€ Dockerfile                     # ğŸ› ï¸ Spring Boot ì•± Docker ë¹Œë“œ íŒŒì¼
â””â”€â”€ step06_SpringDataJPA-0.0.1-SNAPSHOT.jar  # ğŸš€ Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ íŒŒì¼ (JAR)

```
### ğŸ”¹ **ì„¤ëª…**

- `db-backup/`
    - MySQL ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… `.sql` íŒŒì¼ì´ ì €ì¥ë˜ëŠ” í´ë”
  
    - `backup.sh` ì‹¤í–‰ ì‹œ, ìƒˆë¡œìš´ `.sql` íŒŒì¼ì´ ìƒì„±ë¨
    
- `backup.sh`
    - MySQL DBë¥¼ ë°±ì—…í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
      
    - íŠ¹ì • ì£¼ê¸°(`cron`)ë¡œ ì‹¤í–‰ ê°€ëŠ¥ (ì˜ˆ: ìì • ì‹œê°„ë§ˆë‹¤)
- `backup.log`
    - ë°±ì—… íŒŒì¼ì´ ì˜ ìˆ˜í–‰ë˜ì—ˆëŠ”ì§€ ê´€ë¦¬ìê°€ í™•ì¸í•˜ê¸° ìœ„í•œ ë¡œê·¸ íŒŒì¼
- `docker-compose.yml`
    - Docker ì»¨í…Œì´ë„ˆ(ì•±, DB) êµ¬ì„± ë° ì‹¤í–‰ ì„¤ì •
- `Dockerfile`
    - Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ëŠ” ì„¤ì •
- `step06_SpringDataJPA-0.0.1-SNAPSHOT.jar`
    - Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ JAR íŒŒì¼

## 4ï¸âƒ£ Main Flow

### ğŸ“Œ docker-compose

ğŸ’¡ **ë°ì´í„° ì˜ì†ì„±ê³¼ DB ë°±ì—…ì„ ìœ„í•œ ë³¼ë¥¨ ì„¤ì •**

### âœ… Dockerfile

```docker
# Java 17 ê²½ëŸ‰ JRE ê¸°ë°˜ ì´ë¯¸ì§€ ì‚¬ìš©
FROM eclipse-temurin:17-jre-alpine

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# ì• í”Œë¦¬ì¼€ì´ì…˜ JAR íŒŒì¼ ë³µì‚¬
COPY step06_SpringDataJPA-0.0.1-SNAPSHOT.jar app.jar

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (í¬íŠ¸ ë³€ê²½ì´ ìš©ì´í•˜ë„ë¡)
ENV SERVER_PORT=8080

# âœ… INIT_MODE ì— ë”°ë¼ ddl-auto ì„¤ì • ë¶„ê¸°
ENTRYPOINT ["sh", "-c", "java -jar app.jar --spring.jpa.hibernate.ddl-auto=${INIT_MODE}"]
```

### âœ… docker-compose.yml

```yaml
services:
  db:
    container_name: mysqldb
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: [root ë¹„ë°€ë²ˆí˜¸]
      MYSQL_DATABASE: [ë°ì´í„°ë² ì´ìŠ¤]
      MYSQL_USER: [ì‚¬ìš©ì]
      MYSQL_PASSWORD: [ë¹„ë°€ë²ˆí˜¸]
    volumes:
      - mysql-data:/var/lib/mysql       # ğŸŸ¢ MySQL ë°ì´í„° ë³¼ë¥¨(Named Volume)
      - ./db-backup:/backup             # ğŸŸ¢ ë°±ì—… íŒŒì¼ ê³µìœ  ë³¼ë¥¨(í˜¸ìŠ¤íŠ¸ ë§ˆìš´íŠ¸(Bind Mount))
    networks:
      - spring-mysql-net
    healthcheck:
      test: ['CMD-SHELL', 'mysqladmin ping -h 127.0.0.1 -u root --password=$${MYSQL_ROOT_PASSWORD} || exit 1']
      interval: 10s
      timeout: 2s
      retries: 100

  app1:
    container_name: springbootapp01
    build:
      context: .
      dockerfile: ./Dockerfile
    ports:
      - "8081:8080"  # âœ… ìƒˆë¡œìš´ í¬íŠ¸ ë§¤í•‘
    environment:
      MYSQL_HOST: db
      MYSQL_PORT: 3306
      MYSQL_DATABASE: [ë°ì´í„°ë² ì´ìŠ¤]
      MYSQL_USER: [ì‚¬ìš©ì]
      MYSQL_PASSWORD: [ë¹„ë°€ë²ˆí˜¸]
      INIT_MODE: create # âœ… ë°ì´í„° ë² ì´ìŠ¤ ìƒì„± ì‹œ tableë„ í•¨ê»˜ ìƒì„±
    depends_on:
      db:
        condition: service_healthy
    networks:
      - spring-mysql-net

  app2:
    container_name: springbootapp02
    build:
      context: .
      dockerfile: ./Dockerfile
    ports:
      - "8082:8080"  # âœ… ìƒˆë¡œìš´ í¬íŠ¸ ë§¤í•‘
    environment:
      MYSQL_HOST: db
      MYSQL_PORT: 3306
      MYSQL_DATABASE: [ë°ì´í„°ë² ì´ìŠ¤]
      MYSQL_USER: [ì‚¬ìš©ì]
      MYSQL_PASSWORD: [ë¹„ë°€ë²ˆí˜¸]
      INIT_MODE: create # âœ… ë°ì´í„° ë² ì´ìŠ¤ ìƒì„± ì‹œ tableë„ í•¨ê»˜ ìƒì„±
    depends_on:
      db:
        condition: service_healthy
    networks:
      - spring-mysql-net
      
networks:
  spring-mysql-net:
    driver: bridge

volumes:
  mysql-data:  # ğŸŸ¢ Docker named volume ì„ ì–¸

```

### âš™ï¸ Docker Compose í•µì‹¬ ì„¤ì • ë° ê¸°ëŠ¥ ì„¤ëª…

1ï¸âƒ£ **ë°ì´í„° ì˜ì†ì„± ë° ë°±ì—… ì„¤ì •**

- `mysql-data:/var/lib/mysql` â†’ **MySQL ë°ì´í„°ë¥¼ ìœ ì§€í•˜ëŠ” Named Volume** (ì»¨í…Œì´ë„ˆ ì‚­ì œ í›„ì—ë„ ë°ì´í„° ë³´ì¡´)
  
- `./db-backup:/backup` â†’ **ë°±ì—… íŒŒì¼ì„ í˜¸ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ì™€ ê³µìœ **í•˜ì—¬ ì ‘ê·¼ ê°€ëŠ¥
- `healthcheck` â†’ **DBê°€ ì •ìƒ ì‹¤í–‰ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ì—¬ ì•ˆì •ì ì¸ ì—°ê²° ë³´ì¥**

2ï¸âƒ£ **Spring Boot ì•± ì»¨í…Œì´ë„ˆ (`app01`, `app02`)**

- `depends_on: service_healthy` â†’ **DBê°€ ì‹¤í–‰ëœ í›„ ì•± ì‹¤í–‰**
  
- `ports` â†’ **ì•± ë³„ë¡œ ë‹¤ë¥¸ í¬íŠ¸ ì„¤ì • (`8081:8080`, `8082:8080`)**
- `INIT_MODE=create` â†’ **ì´ˆê¸° í…Œì´ë¸” ìë™ ìƒì„±, ì´í›„ ìœ ì§€í•˜ì—¬ ë°ì´í„° ë³´ì¡´**

3ï¸âƒ£ **ë„¤íŠ¸ì›Œí¬ & ë³¼ë¥¨ ì„¤ì •**

- `networks: bridge` â†’ **Spring Bootì™€ MySQLì´ ê°™ì€ ë„¤íŠ¸ì›Œí¬ì—ì„œ í†µì‹  ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •**
  
- `mysql-data` â†’ **DB ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ìœ ì§€í•˜ì—¬ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ì‹œì—ë„ ì •ë³´ ë³´ì¡´**

### âœ… docker compose ì‹¤í–‰

```bash
docker-compose up -d
```

![image](https://github.com/user-attachments/assets/5af4f229-01e9-48c9-b840-de41838ec413)


curl ëª…ë ¹ì–´ë¥¼ í†µí•´ ë‘ ê°œì˜ Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê°™ì€ DBë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ.

---

### ğŸ“Œ DB ë°±ì—… ìë™í™”

ğŸ’¡ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸(`backup.sh`)ë¥¼ ìƒì„± í›„ `crontab`ì— ë“±ë¡í•˜ì—¬ **ìë™í™” êµ¬ì„±**

### 1. `backup.sh` íŒŒì¼ ìƒì„±

```bash
nano backup.sh
```

**ğŸ“„ `backup.sh` (ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸)**

```bash
#!/bin/bash

# ì ˆëŒ€ ê²½ë¡œë¡œ ì„¤ì • (í˜¸ìŠ¤íŠ¸ ê¸°ì¤€)
BACKUP_DIR="/home/ubuntu/06.dockerCompose/db-backup"

# ë°±ì—… íŒŒì¼ ì´ë¦„ (ë‚ ì§œ/ì‹œê°„ í¬í•¨)
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
BACKUP_FILE="fisa_backup_${TIMESTAMP}.sql"

# ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±
mkdir -p "${BACKUP_DIR}"

# ë°±ì—… ì‹¤í–‰
echo "ğŸ“¦ MySQL ë°±ì—… ì¤‘... (${BACKUP_FILE})"
docker exec mysqldb /usr/bin/mysqldump -u root -proot fisa > "${BACKUP_DIR}/${BACKUP_FILE}"

# ê²°ê³¼ í™•ì¸
if [ $? -eq 0 ]; then
  echo "âœ… ë°±ì—… ì™„ë£Œ: ${BACKUP_DIR}/${BACKUP_FILE}"
  
  # ğŸ”¥ 7ì¼ ì´ìƒëœ ë°±ì—… íŒŒì¼ ìë™ ì‚­ì œ
  find ${BACKUP_DIR} -name "*.sql" -type f -mtime +7 -exec rm {} \;
  echo "ğŸ§¹ 7ì¼ ì´ìƒëœ ë°±ì—… íŒŒì¼ ì •ë¦¬ ì™„ë£Œ"
else
  echo "âŒ ë°±ì—… ì‹¤íŒ¨"
fi
```

- **í’€ ë°±ì—…ì„ ì£¼ê¸°ì ìœ¼ë¡œ í•˜ê³ , ì˜¤ë˜ëœ ë°±ì—…ì€ ìë™ ì‚­ì œ**

### 2. ê¶Œí•œ ë¶€ì—¬ (ì¤‘ìš”â—)

- ì‹¤í–‰ ê¶Œí•œ

```bash
sudo chmod +x backup.sh
```

- í¸ì§‘ ê¶Œí•œ

```bash
sudo chmod 744 /db-backup
```

### 3. ìˆ˜ë™ ì‹¤í–‰ í…ŒìŠ¤íŠ¸

```bash
./backup.sh
```

> ./db-backup í´ë”ì— .sql íŒŒì¼ì´ ìƒê¸°ë©´ ì„±ê³µ!
> 

![image](https://github.com/user-attachments/assets/602d1469-981f-4727-86d9-ea9170acdd5b)

#### ì‹¤í–‰ ê²°ê³¼ : `./db-backup` í´ë”ì— ìƒê¸´ íŒŒì¼

```sql
-- MySQL dump 10.13  Distrib 8.0.41, for Linux (x86_64)
--
-- Host: localhost    Database: fisa
-- ------------------------------------------------------
-- Server version	8.0.41

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `people`
--

DROP TABLE IF EXISTS `people`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `people` (
  `age` int NOT NULL,
  `no` bigint NOT NULL,
  `people_name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`no`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `people`
--

LOCK TABLES `people` WRITE;
/*!40000 ALTER TABLE `people` DISABLE KEYS */;
INSERT INTO `people` VALUES (26,1,'ê¹€ì—°ì•„');
/*!40000 ALTER TABLE `people` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `people_seq`
--

DROP TABLE IF EXISTS `people_seq`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `people_seq` (
  `next_val` bigint DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `people_seq`
--

LOCK TABLES `people_seq` WRITE;
/*!40000 ALTER TABLE `people_seq` DISABLE KEYS */;
INSERT INTO `people_seq` VALUES (101);
/*!40000 ALTER TABLE `people_seq` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2025-03-21  5:21:56

```

### 4. Crontab ì„¤ì •

**ë§¤ì¼ ìì •ì— DB ë°±ì—… íŒŒì¼ ìƒì„±**

```bash
crontab -e
```

```bash
0 0 * * * /home/ubuntu/06.dockerCompose/backup.sh >> /home/ubuntu/06.dockerCompose/backup.log 2>&1
```


## 5ï¸âƒ£ Trouble Shooting

### **1.** `fisa.people` í…Œì´ë¸”ì´ ì—†ì–´ ì‹¤í–‰ ì¤‘ SQL ì—ëŸ¬ ë°œìƒ

![image](https://github.com/user-attachments/assets/5ab8f1d7-c8f5-4c61-b900-6e02cb828ef8)

**â— ì›ì¸ :** 

1. `application.properties`ì—ì„œ `spring.jpa.hibernate.ddl-auto=none` ì„¤ì •

2. `spring.sql.init.mode=always` ì„¤ì •

**â‡’ Spring Boot ì•± ì‹¤í–‰ ì‹œ `fisa.people` í…Œì´ë¸”ì´ ì—†ë‹¤ëŠ” ì˜¤ë¥˜ ë°œìƒ**

```bash
SQLSyntaxErrorException: Table 'fisa.people' doesn't exist
```

**ğŸ’¡ í•´ê²° ë°©ì•ˆ :**

- Dockerì—ì„œëŠ” MySQL ì»¨í…Œì´ë„ˆê°€ ë”°ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ, **ìµœì´ˆ í•œ ë²ˆë§Œ `create` ì ìš© í›„ `none`ìœ¼ë¡œ ë³€ê²½í•˜ë©´ í•´ê²° ê°€ëŠ¥í•˜ë‹¤.**
  
  1. **ì´ˆê¸° ì‹¤í–‰ ì‹œ `ddl-auto=create` ì ìš©**
      - `docker-compose.yml`ì—ì„œ í™˜ê²½ ë³€ìˆ˜ `INIT_MODE: create` ì¶”ê°€
  2. **ê·¸ ì´í›„ ì‹¤í–‰ ì‹œ `ddl-auto=none` ì ìš©**
      - `docker-compose.yml`ì—ì„œ `INIT_MODE: none` ì ìš©
  3. **Dockerfileì—ì„œ ENTRYPOINTë¡œ ì‹¤í–‰ ì‹œ `INIT_MODE` ê°’ì„ ë°˜ì˜**
        
     ```docker
     ENTRYPOINT ["sh", "-c", "java -jar app.jar --spring.jpa.hibernate.ddl-auto=${INIT_MODE}"]
     ```
        
      - ì‹¤í–‰ ëª…ë ¹ì–´ê°€ ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§€ë¯€ë¡œ `application.properties`ì˜ `ddl-auto=none` ì„¤ì •ì„ ë®ì–´ì”Œìš¸ ìˆ˜ ìˆìŒ.

### 2. ë³¼ë¥¨ ë‚´ë¶€ í´ë”ì— ëŒ€í•œ ê¶Œí•œ ë¬¸ì œ

**â— ì›ì¸ :** 

- ì„¤ê³„ ì´ˆê¸°ì— ì˜ì†ì„±ì„ ìœ„í•œ .sql íŒŒì¼ê³¼ ë°±ì—… íŒŒì¼ ëª¨ë‘ ë³¼ë¥¨ì— ì €ì¥ë˜ë„ë¡ ì„¤ì •í•˜ì˜€ë‹¤.
- ê·¸ëŸ¬ë‚˜, ë³¼ë¥¨ì€ root ê¶Œí•œì´ì§€ë§Œ cronì€ ì‹¤í–‰í•˜ëŠ” ubuntuì˜ ê¶Œí•œì„ ê°€ì§€ë¯€ë¡œ ì ‘ê·¼ ê¶Œí•œì´ ì—†ì–´ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ë‹¤.

```yaml
    volumes:
      - mysql-data:/var/lib/mysql
      - mysql-backup:/backup
```

```bash
/home/ubuntu/06.dockerCompose/backup.sh: line 8: /var/lib/docker/volumes/06dockercompose_mysql-backup/_data/db_backup_2025-03-21_11-49-01.sql: Permission denied
```

**ğŸ’¡ í•´ê²° ë°©ì•ˆ :**

- ë³¼ë¥¨ ë§ˆìš´íŠ¸ê°€ ì•„ë‹Œ í˜¸ìŠ¤íŠ¸ ë§ˆìš´íŠ¸ë¡œ ë³€ê²½í•œë‹¤.
    
    ```yaml
        volumes:
          - mysql-data:/var/lib/mysql       # ğŸŸ¢ MySQL ë°ì´í„° ë³¼ë¥¨
          - ./db-backup:/backup             # ğŸŸ¢ ë°±ì—… íŒŒì¼ ê³µìœ  ë³¼ë¥¨
    ```
    
- ì‹¤ì œ ì‹¤ë¬´ì—ì„œëŠ” AWS S3ì™€ ê°™ì€ ë‹¤ì–‘í•œ ì™¸ë¶€ ìŠ¤í† ë¦¬ì§€(í•„ìš”ì— ë”°ë¼ ë‚´ë¶€)ì— ì €ì¥ë˜ë„ë¡ í•œë‹¤.
